<!DOCTYPE html>
<html>
	<head>
		<title>Caleb's Logbook</title>
		<meta name='description' content='Page in project'/>
                <meta name='robots' content='noindex nofollow'/>
                <meta http-equiv='author' content='mgalle'/>
                <meta http-equiv='pragma' content='no-cache'/>
		
		<link href='/css/logbook.css' type='text/css' rel='stylesheet'/>

		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
	</head>
	<body>
		<div id="page" class="container">
		
			<h1>Welcome To Caleb's Logbook</h1>
			<ul>
				<li><a href='#week1'>Week 1</a></li>
				<li><a href='#week2'>Week 2</a></li>
				<li><a href='#week3'>Week 3</a></li>
				<li><a href='#week4'>Week 4</a></li>
				<li><a href="#week5">Week 5</a></li>
				<li><a href='#week6'>Week 6</a></li>
				<li><a href='#week8'>Week 8</a></li>
				<li><a href='#week9'>Week 9</a></li>
				
			</ul>

			<h2 id='week1'>Week 1</h2>
			<ul>
				<li>Set up Project Plan, dividing tasks equally and according to experience</li>
				<li>Added the project plan to the Confluence page for review and discussed it with team-mates</li>
				<li>Attempted STM32 HAL programming using STM32CubeMx and Atollic TrueSTUDIO but it didn't work</li>
			</ul>
			
			<h2 id='week2'>Week 2</h2>
			<ul>
				<li>
					Tested CAN interface on local STM32:
					<ol>
						<li>Finished setting up the CAN interface using the STM32 HAL introduction document from eConestoga (using STM32CubeIDE this time)</li>
						<li>Looked online to find how to run in loopback mode</li>
						<li>Tested the CAN interface by experimenting with filters</li>
						<li>
							Recorded a 
							<a href="../video.html#canHalDemo">video</a> 
							of it working
						</li>
						<li>
							Added the code to a separate 
							<a href="https://www.github.com/choeksema/Nucleo-F303RE_HAL_CAN" target=_blank title="Open repository in new tab">repository</a> 
							on Github
						</li>
					</ol>
				</li>
				<li>Updated project plan as per last week's debrief</li>
				<li>Tested the VNC connection to the Raspberry Pi</li>
			</ul>

			<h2 id='week3'>Week 3</h2>
			<ul>
				<li>Investigated Sabbath Mode</li>
				<ul>
					<li>Not sure if we should have an overall on/off command for Sabbath mod, especially if Sabbath mode ignores regular commands so still reaches all the floors consistently</li>
					<li>At least 3 options for operation:</li>
					<ol>
						<li>Stop at each floor up and down</li>
						<li>Stop at alternate floors up and down</li>
						<li>Rise all the way to the top and stop at each floor when going down only</li>
					</ol>
					<li>Overall process:</li>
					<ol>
						<li>Check time and date</li>
						<li>If the Sabbath, move to the first floor and then start following the chosen procedure (one of those listed above) while ignoring regular commands</li>
						<li>If not the Sabbath, wait for user input</li>
					</ol>
				</ul>
				<li>Investigated the database</li>
				<ul>
					<li>The database already exists with implemented controls and C++/PHP code for interacting with the database. Do we use this or write our own?</li>
					<ul>
						<li>Plan to ask at debreif</li>
					</ul>
				</ul>
			</ul>

			<h2 id='week4'>Week 4</h2>
			<div class="row">
				<div class="col-sm-5 col-md-6">
					<ul>
						<li>Tried to implement an SSH terminal in the browser using "shellinabox"</li>
						<ul>
							<li>Hosted the connection from a local Linux through https and could run shell commands through the browser from another computer on the local Wifi network</li>
							<li>Tried to implement the service on the Pi in order to test over the VPN but the service would not start</li>
							<li>Next day when trying to run the service over local Wifi, the service refused to start no matter what I tried</li>
							<li>Started looking into passing commands through JavaScript from the browser but that may not be possible since it seems that JavaScript is isolated from the system for security reasons</li>
						</ul>
						<li>Updated the project plan based on last week's feedback</li>
						<li>Updated the elevator control FSM based on feedback from last week</li>
					</ul>
				</div>
				<div class="col-sm-5 col-md-6">
					<img src="../images/FSM_W4.png" alt="Week 4 FSM revision" width="400">
				</div>
			</div>

			<h2 id='week5'>Week 5</h2>
			<div class="row">
				<div class="col-sm-5 col-md-6">
					<ul>
						<li>As per last week's debrief (not in the logbook though), I added a terminal to the project website diagnostics page. The project we used is available <a href="https://github.com/nickola/web-console" target="_blank">here</a>.</li>
						<li>Looked into using the embedded SSH terminal on the diagnostics page for file editing</li>
						<ul>
							<li>It won't work as it is since it isn't an open connection</li>
							<li>Webpages time out every <i>x</i> seconds</li>
							<li>There might be permissions issues. Having <i>sudo</i> permissions available on the website can be dangerous if people outside the project sign into the terminal. If we kept the website behind a sign-in page where new users could not create an account without permission/confirmation, you could get around this issue. </li>
						</ul>
						<li>Updated the elevator control FSM based on feedback from last week</li>
					</ul>
				</div>
				<div class="col-sm-5 col-md-6">
					<img src="../images/FSM_W5.png" alt="Week 5 FSM revision" width="300">
				</div>
			</div>

			<h2 id='week6'>Week 6</h2>
			<ul>
				<li>This week, I set up basic classes for PCAN and database interaction on the server Pi. I made a basic mainline around it so if that program is running, then a user on the website can control the elevator. (<a href="https://github.com/choeksema/Eng_Proj_VI_dbToCan" target="_blank">code</a>)</li>
				<li>Changed the PHP side to update the requested floor column instead of the current floor column so the elevator could move and then the current floor would be updated by the Pi.</li>
				<li>Set up a database table to log how often the elevator stops at each floor.</li>
			</ul>
			
			<h2 id='week8'>Week 8 (Success Week)</h2>
			<ul>
				<li>This week, I tried to set up the elevator code to run periodically with crontab but it doesn't seem to work in seconds.</li>
				<li>I decided to set up the elevator code as a service to periodically run the elevator moving exe "dbTesting" (that name should change). I set it to run every 2 seconds.</li>
				<ul>
					<li>One potential problem here is that only the last floor value is saved. So, some data may be lost. The database may need to be reconfigured or something else will need to be reworked.</li>
				</ul>
				<li>Looked into implementing an FSM but did not get very far. I will work on this in the coming week.</li>
			</ul>

			<h2 id='week9'>Week 9</h2>
			<ul>
				<li>This week, I revamped the DB code to make it better</li>
				<li>I created a new repos with the elevator code. The main reason for the new repos was to reorganize all the files (although most files had a lot of rework)</li>
				<li>Made a program to substitute as the website for independent testing</li>
				<li>Implemented the FSM based on the lecture notes from DS&A S3</li>
				<ul>
					<li>There seems to be no way to know if the elevator is above or below floor 2 when it is moving. So, the FSM isn't perfect. Hopefully, I have a chance to take another look this week.</li>
				</ul>
				<li>Got communication from the database to the FSM locally but when I put it on the pi to add "move elevator" commands, the Pi decided not to behave. It failed consistently on a call to "next()" on a ResultSet pointer. Spent a few hours trying to debug.</li>
				<li>Because of the previous point, I removed the database communication for now. The user can type a button "press" and the elevator will move accordingly.</li>
				<li>Implemented a basic Sabbath mode. Right now, it runs on demand and doesn't care about what time it is.</li>
			</ul>

			<hr>

			<p><a href="/about.html">Return</a></p>
		</div>
	</body>
</html>
